getgenv().WebhookURL = getgenv().WebhookURL or "YOUR_WEBHOOK_URL_HERE"

-- Function to format large numbers
local function format_number(number)
    local suffixes = {"", "K", "M", "B", "T", "QD"}
    local index = 1
    while math.abs(number) >= 1000 and index < #suffixes do
        number = number / 1000.0
        index = index + 1
    end
    return string.format("%.2f%s", number, suffixes[index])
end

-- Function to send a webhook message
local function webhookmessage(data, link)
    local HttpService = game:GetService("HttpService")
    local response = http_request({
        Url = link,
        Method = "POST",
        Headers = {["Content-Type"] = "application/json"},
        Body = HttpService:JSONEncode(data)
    })
    print(response.Success)
end

-- Function to update player stats and send them to the webhook
local function updatePlayerStatsAndSendWebhook(player)
    local playerStats = game.ReplicatedStorage:FindFirstChild("Datas"):FindFirstChild(tostring(player.UserId))
    if playerStats then
        -- Abbreviate stats and rebirths using format_number
        local strength = playerStats:FindFirstChild("Strength") and format_number(playerStats.Strength.Value) or math.huge
        local defense = playerStats:FindFirstChild("Defense") and format_number(playerStats.Defense.Value) or math.huge
        local energy = playerStats:FindFirstChild("Energy") and format_number(playerStats.Energy.Value) or math.huge
        local speed = playerStats:FindFirstChild("Speed") and format_number(playerStats.Speed.Value) or math.huge
        local rebirths = playerStats:FindFirstChild("Rebirth") and playerStats.Rebirth.Value or 0  -- Correct way to grab rebirths

        local world = game.PlaceId == 5151400895 and "Bills" or "Earth"

        local data = {
            content = "",
            embeds = {{
                title = "Stat Farm - " .. player.Name,
                description = string.format("Planet: **%s**\nStrength: **%s**\nDefense: **%s**\nEnergy: **%s**\nSpeed: **%s**\nRebirths: **%s**", world, strength, defense, energy, speed, format_number(rebirths)),
                color = 6248703,
                footer = {text = "v0.1", icon_url = "https://cdn.discordapp.com/attachments/1294895323852050475/1295927395018215486/newid.png"},
                thumbnail = {url = "https://tr.rbxcdn.com/180DAY-fa4640ea47b1096f1be0d0ecb3e58ba9/768/432/Image/Webp/noFilter"}
            }},
            username = "webhook testing",
            avatar_url = "https://cdn.discordapp.com/attachments/1294895323852050475/1295927395018215486/newid.png"
        }

        webhookmessage(data, getgenv().WebhookURL)
    end
end

-- Loop to send webhook every 5 minutes
while true do
    pcall(function() updatePlayerStatsAndSendWebhook(game.Players.LocalPlayer) end)
    wait(300)  -- Wait for 5 minutes (300 seconds)
end
